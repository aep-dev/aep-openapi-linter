aliases:
  CreateOperation:
    description: A create operation is a post on path without a ":" in the final segment
    targets:
      - formats: ['oas2', 'oas3']
        given:
          # @property is the key of the object in the paths object
          - $.paths[?(!@property.match(/:[^/]*$/))].post

rules:
  aep-133-required-params:
    description: A create operation must not have any required parameters other than path parameters.
    severity: error
    formats: ['oas2', 'oas3']
    given:
      - '#CreateOperation.parameters[?(@.in != "path")]'
      - '#CreateOperation^.parameters[?(@.in != "path")]' # parameters at path item level
    then:
      field: required
      function: falsy

  aep-133-unknown-optional-params:
    description: A create operation should not have unknown optional parameters.
    severity: warn
    formats: ['oas2', 'oas3']
    given:
      - '#CreateOperation.parameters[?(@.in == "query")]' # only check query parameters
      - '#CreateOperation^.parameters[?(@.in == "query")]' # parameters at path item level
    then:
      function: schema
      functionOptions:
        schema:
          type: object
          properties:
            name:
              type: string
              enum: ['id']
