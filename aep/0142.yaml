functionsDir: ../functions
functions:
  - aep-142-time-field-type

rules:
  aep-142-time-field-type:
    description: 'Fields with time-related suffixes should use appropriate types and formats.'
    message: '{{error}}'
    severity: warn
    formats: ['oas2', 'oas3']
    given: '$..properties[?(@property.match(/_(time|times|date|seconds|millis|micros|nanos)$/))]'
    then:
      function: aep-142-time-field-type

  aep-142-time-field-names:
    description: 'Timestamp fields should use imperative mood with _time suffix, not past tense.'
    message: 'Use imperative mood with "_time" suffix (e.g., "{{property}}_time") instead of past tense.'
    severity: warn
    formats: ['oas2', 'oas3']
    given: '$..[?(@.type == "string" && @.format == "date-time")]~'
    then:
      field: '@key'
      function: pattern
      functionOptions:
        notMatch: '(created|creation|updated|modified|expired|purged|deleted|published|started|ended|completed)'

  aep-142-time-field-suffix:
    description: 'Timestamp fields must end in _time suffix.'
    message: 'Timestamp field "{{property}}" should end with "_time" suffix.'
    severity: warn
    formats: ['oas2', 'oas3']
    given: '$..[?(@.type == "string" && @.format == "date-time")]~'
    then:
      field: '@key'
      function: pattern
      functionOptions:
        match: '_time$'
