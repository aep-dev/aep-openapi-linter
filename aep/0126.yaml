functionsDir: ../functions
functions:
  - aep-126-enum-case-consistent

aliases:
  EnumProperty:
    description: An enumerated property.
    targets:
      - formats: ['oas2', 'oas3']
        given:
          - $..[?(@property === 'enum')]^

rules:
  aep-126-enum-type-string:
    description: Enumerated fields should use type string, not integer or other types.
    message: Enum field "{{property}}" should have type "string", not "{{error}}".
    severity: error
    formats: ['oas2', 'oas3']
    given: '#EnumProperty'
    then:
      field: type
      function: schema
      functionOptions:
        schema:
          oneOf:
            - const: string
            - type: array
              contains:
                const: string
                # Exclude everything else but "null"
                not:
                  anyOf:
                    - const: boolean
                    - const: integer
                    - const: number
                    - const: object
                    - const: array

  aep-126-enum-case-consistent:
    description: All enum values in a field should use consistent case format.
    message: '{{error}}'
    severity: warn
    formats: ['oas2', 'oas3']
    given: '#EnumProperty'
    then:
      function: aep-126-enum-case-consistent

  aep-126-no-standard-value-enums:
    description: Fields should not enumerate standard codes (language, country, currency, media types).
    severity: warn
    formats: ['oas2', 'oas3']
    given:
      - $..properties[[?(@property == 'language' || @property == 'language_code')]]
      - $..properties[[?(@property == 'country' || @property == 'country_code' || @property == 'region_code')]]
      - $..properties[[?(@property == 'currency' || @property == 'currency_code')]]
      - $..properties[[?(@property == 'media_type' || @property == 'content_type')]]
    then:
      function: schema
      functionOptions:
        schema:
          type: object
          not:
            required: ['enum']

  aep-126-enum-has-description:
    description: Enum fields should include a description explaining their purpose.
    message: Enum field "{{property}}" should have a description.
    severity: info
    formats: ['oas2', 'oas3']
    given: '#EnumProperty'
    then:
      field: description
      function: truthy
